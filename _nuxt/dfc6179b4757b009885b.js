(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{368:function(e,t,n){},369:function(e,t,n){"use strict";n(374);var r=n(3),o=n(370),c=n(37),l=n(5),d=n(1),h=n(7),v=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e};t.a=Object(h.a)(r.a,o.a,c.a,l.a).extend({name:"v-card",props:{flat:Boolean,hover:Boolean,img:String,raised:Boolean,tag:{type:String,default:"div"},tile:Boolean},computed:{classes:function(){return v({"v-card":!0,"v-card--flat":this.flat,"v-card--hover":this.hover,"v-card--raised":this.raised,"v-card--tile":this.tile},this.themeClasses)},styles:function(){var style={height:Object(d.b)(this.height)};return this.img&&(style.background='url("'+this.img+'") center center / cover no-repeat'),this.height&&(style.height=Object(d.b)(this.height)),this.maxHeight&&(style.maxHeight=Object(d.b)(this.maxHeight)),this.maxWidth&&(style.maxWidth=Object(d.b)(this.maxWidth)),this.width&&(style.width=Object(d.b)(this.width)),style}},render:function(e){var t=this.generateRouteLink(this.classes),n=t.tag,data=t.data;return data.style=this.styles,e(n,this.setBackgroundColor(this.color,data),this.$slots.default)}})},370:function(e,t,n){"use strict";var r=n(0);t.a=r.a.extend({name:"measurable",props:{height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],width:[Number,String]}})},371:function(e,t,n){"use strict";var r=n(0);t.a=r.a.extend({name:"v-card-title",functional:!0,props:{primaryTitle:Boolean},render:function(e,t){var data=t.data,n=t.props,r=t.children;return data.staticClass=("v-card__title "+(data.staticClass||"")).trim(),n.primaryTitle&&(data.staticClass+=" v-card__title--primary"),e("div",data,r)}})},372:function(e,t,n){"use strict";n(108);var r=n(80);t.a=Object(r.a)("flex")},373:function(e,t,n){"use strict";n(108);var r=n(80);t.a=Object(r.a)("layout")},374:function(e,t,n){},375:function(e,t,n){},376:function(e,t,n){},377:function(e,t,n){"use strict";var r=n(368);n.n(r).a},378:function(e,t,n){},379:function(e,t,n){"use strict";var r={data:function(){return{show:!1}},props:{code:{type:String,default:""},language:{type:String,default:"javascript"},copyable:{type:Boolean,default:!1}},computed:{slotContent:function(){return this.code||this.$slots.default?(this.$slots.default[0].text||"").trim():(console.error("Missing content for code-copy element"),"[Missing content]")}},methods:{copy:function(){if(this.copyable){var e=document.createElement("textarea");e.value=this.code||this.slotContent,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.show=!0}}}},o=(n(377),n(23)),c=n(81),l=n.n(c),d=(n(378),n(3)),h=n(18),v=n(38),m=n(7),f=Object(m.a)(d.a,h.a,Object(v.b)(["absolute","top","bottom","left","right"])).extend({name:"v-snackbar",props:{autoHeight:Boolean,multiLine:Boolean,timeout:{type:Number,default:6e3},vertical:Boolean},data:function(){return{activeTimeout:-1}},computed:{classes:function(){return{"v-snack--active":this.isActive,"v-snack--absolute":this.absolute,"v-snack--auto-height":this.autoHeight,"v-snack--bottom":this.bottom||!this.top,"v-snack--left":this.left,"v-snack--multi-line":this.multiLine&&!this.vertical,"v-snack--right":this.right,"v-snack--top":this.top,"v-snack--vertical":this.vertical}}},watch:{isActive:function(){this.setTimeout()}},mounted:function(){this.setTimeout()},methods:{setTimeout:function(){var e=this;window.clearTimeout(this.activeTimeout),this.isActive&&this.timeout&&(this.activeTimeout=window.setTimeout(function(){e.isActive=!1},this.timeout))}},render:function(e){var t=[];return this.isActive&&t.push(e("div",{staticClass:"v-snack",class:this.classes,on:this.$listeners},[e("div",this.setBackgroundColor(this.color,{staticClass:"v-snack__wrapper"}),[e("div",{staticClass:"v-snack__content"},this.$slots.default)])])),e("transition",{attrs:{name:"v-snack-transition"}},t)}}),component=Object(o.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{copyable:e.copyable,copy:!0},on:{click:e.copy}},[n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs",value:e.code||e.slotContent,expression:"code || slotContent"}]},[n("code",{class:e.language})]),e._v(" "),n("v-snackbar",{attrs:{timeout:2e3},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[e._v("\n    Copié ;-)\n  ")]),e._v(" "),n("br")],1)},[],!1,null,"55ae2834",null);t.a=component.exports;l()(component,{VSnackbar:f})},380:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(1),o=n(360),c=n(361),l=n(372),d=n(373),h=Object(r.d)("spacer","div","v-spacer");o.a,c.a,l.a,d.a},381:function(e,t,n){"use strict";var r=n(1),o=n(369),c=(n(375),n(376),n(370)),l=n(7),d=Object(l.a)(c.a).extend({name:"v-responsive",props:{aspectRatio:[String,Number]},computed:{computedAspectRatio:function(){return Number(this.aspectRatio)},aspectStyle:function(){return this.computedAspectRatio?{paddingBottom:1/this.computedAspectRatio*100+"%"}:void 0},__cachedSizer:function(){return this.aspectStyle?this.$createElement("div",{style:this.aspectStyle,staticClass:"v-responsive__sizer"}):[]}},methods:{genContent:function(){return this.$createElement("div",{staticClass:"v-responsive__content"},this.$slots.default)}},render:function(e){return e("div",{staticClass:"v-responsive",style:{height:Object(r.b)(this.height),maxHeight:Object(r.b)(this.maxHeight),maxWidth:Object(r.b)(this.maxWidth),width:Object(r.b)(this.width)},on:this.$listeners},[this.__cachedSizer,this.genContent()])}}),h=n(8),v=d.extend({name:"v-img",props:{alt:String,contain:Boolean,src:{type:[String,Object],default:""},gradient:String,lazySrc:String,srcset:String,sizes:String,position:{type:String,default:"center center"},transition:{type:[Boolean,String],default:"fade-transition"}},data:function(){return{currentSrc:"",image:null,isLoading:!0,calculatedAspectRatio:void 0}},computed:{computedAspectRatio:function(){return this.normalisedSrc.aspect},normalisedSrc:function(){return"string"==typeof this.src?{src:this.src,srcset:this.srcset,lazySrc:this.lazySrc,aspect:Number(this.aspectRatio||this.calculatedAspectRatio)}:{src:this.src.src,srcset:this.srcset||this.src.srcset,lazySrc:this.lazySrc||this.src.lazySrc,aspect:Number(this.aspectRatio||this.src.aspect||this.calculatedAspectRatio)}},__cachedImage:function(){if(!this.normalisedSrc.src&&!this.normalisedSrc.lazySrc)return[];var e=[],t=this.isLoading?this.normalisedSrc.lazySrc:this.currentSrc;this.gradient&&e.push("linear-gradient("+this.gradient+")"),t&&e.push('url("'+t+'")');var image=this.$createElement("div",{staticClass:"v-image__image",class:{"v-image__image--preload":this.isLoading,"v-image__image--contain":this.contain,"v-image__image--cover":!this.contain},style:{backgroundImage:e.join(", "),backgroundPosition:this.position},key:+this.isLoading});return this.transition?this.$createElement("transition",{attrs:{name:this.transition,mode:"in-out"}},[image]):image}},watch:{src:function(){this.isLoading?this.loadImage():this.init()},"$vuetify.breakpoint.width":"getSrc"},beforeMount:function(){this.init()},methods:{init:function(){if(this.normalisedSrc.lazySrc){var e=new Image;e.src=this.normalisedSrc.lazySrc,this.pollForSize(e,null)}this.normalisedSrc.src&&this.loadImage()},onLoad:function(){this.getSrc(),this.isLoading=!1,this.$emit("load",this.src)},onError:function(){Object(h.a)("Image load failed\n\nsrc: "+this.normalisedSrc.src,this),this.$emit("error",this.src)},getSrc:function(){this.image&&(this.currentSrc=this.image.currentSrc||this.image.src)},loadImage:function(){var e=this,image=new Image;this.image=image,image.onload=function(){image.decode?image.decode().catch(function(t){Object(h.b)("Failed to decode image, trying to render anyway\n\nsrc: "+e.normalisedSrc.src+(t.message?"\nOriginal error: "+t.message:""),e)}).then(e.onLoad):e.onLoad()},image.onerror=this.onError,image.src=this.normalisedSrc.src,this.sizes&&(image.sizes=this.sizes),this.normalisedSrc.srcset&&(image.srcset=this.normalisedSrc.srcset),this.aspectRatio||this.pollForSize(image),this.getSrc()},pollForSize:function(img){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;!function n(){var r=img.naturalHeight,o=img.naturalWidth;r||o?e.calculatedAspectRatio=o/r:null!=t&&setTimeout(n,t)}()},__genPlaceholder:function(){if(this.$slots.placeholder){var e=this.isLoading?[this.$createElement("div",{staticClass:"v-image__placeholder"},this.$slots.placeholder)]:[];return this.transition?this.$createElement("transition",{attrs:{name:this.transition}},e):e[0]}}},render:function(e){var t=d.options.render.call(this,e);return t.data.staticClass+=" v-image",t.data.attrs={role:this.alt?"img":void 0,"aria-label":this.alt},t.children=[this.__cachedSizer,this.__cachedImage,this.__genPlaceholder(),this.genContent()],e(t.tag,t.data,t.children)}}).extend({name:"v-card-media",mounted:function(){Object(h.c)("v-card-media",this.src?"v-img":"v-responsive",this)}}),m=n(371),f=n(0);n.d(t,"a",function(){return _}),n.d(t,"b",function(){return y});var _=f.a.extend(Object(r.d)("v-card__actions")),y=f.a.extend(Object(r.d)("v-card__text"));o.a,m.a},409:function(e,t,n){"use strict";n.r(t);var r={components:{CodeCopy:n(379).a},data:function(){return{service_api:'import store from "@/store.js"\n\nexport const BASE_URL = \'https://vue-js-backend.herokuapp.com\'\n\nexport async function api (url, params = {}) {\n    params = Object.assign({\n        mode: "cors",\n        cache: "no-cache",\n    }, params)\n\n    params.headers = Object.assign({\n        Authorization: `Bearer ${store.state.token}`,\n        "Content-Type": "application/json"\n    }, params.headers)\n\n    let response = await fetch(BASE_URL + url, params)\n    let json = await response.json()\n    if (!response.ok){\n        let errorMessage = json && json.error ? json.error.error || json.error : response.status\n        throw new Error(errorMessage);\n    }\n    return json\n}',service_user:"import { api } from '@/services/api.js'\n\nexport default {\n  register (credentials) {\n    return api('/user/register', {\n      method: 'POST',\n      body: JSON.stringify(credentials)\n    })\n  },\n  login (credentials) {\n    return api('/user/login', {\n      method: 'POST',\n      body: JSON.stringify(credentials)\n    })\n  },\n  user () {\n    return api('/user')\n  }\n}",service_call:"import UserService from '@/services/UserService.js'\n\nexport default {\n  methods: {\n    async register () {\n      try {\n        const response = await UserService.register({\n          email: this.email,\n          password: this.password,\n          firstname: \"John\",\n          lastname: \"Smith\"\n        })\n        this.$store.dispatch('setUser', response.user)\n        this.$store.dispatch('setToken', response.token)\n        this.$router.push('/search')\n      } catch (error) {\n        this.error = error.toString()\n      }\n    },\n    async login () {\n      try {\n        const response = await UserService.login({ email: this.email, password: this.password })\n        this.$store.dispatch('setUser', response.user)\n        this.$store.dispatch('setToken', response.token)\n        this.$router.push('/search')\n      } catch (error) {\n        this.error = error.toString()\n      }\n    }\n  }\n}",store_user:"import Vue from 'vue'\nimport Vuex from 'vuex'\nimport createPersistedState from 'vuex-persistedstate'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  strict: true,\n  plugins: [\n    createPersistedState()\n  ],\n  state: {\n    loggedIn: false,\n    token: undefined,\n    user: undefined\n  },\n  mutations: {\n    setUser (state, user) {\n      state.user = user\n      state.loggedIn = !!user\n    },\n    setToken (state, token) {\n      state.token = token\n    }\n  },\n  actions: {\n    setUser ({commit}, user) {\n      commit('setUser', user)\n    },\n    setToken ({commit}, token) {\n      commit('setToken', token)\n    }\n  }\n})"}}},o=n(23),c=n(81),l=n.n(c),d=n(367),h=n(74),v=n(369),m=n(381),f=n(371),_=n(372),y=n(75),S=n(373),k=n(380),component=Object(o.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-layout",{attrs:{column:"","justify-center":"","align-center":""}},[n("v-flex",{attrs:{xs12:"",sm8:"",md6:""}},[n("v-card",[n("v-card-title",{staticClass:"headline primary--text"},[e._v("\n        Requêtes HTTP\n      ")]),e._v(" "),n("v-card-text",[n("h2",{staticClass:"subheading primary--text pa-2"},[e._v("\n          Architecture\n        ")]),e._v(" "),n("p",[e._v("Dans une Single Page Application, la communication avec le serveur se fait via des requêtes AJAX ou des protocoles plus spécialisés comme les WebSocket. Nous allons voir comment intégrer des appels réseau dans une application Vue.")]),e._v(" "),n("p",[e._v("\n          La méthode "),n("code",[e._v("fetch")]),e._v(" permet de lancer une requête HTTP en JavaScript et retourne une "),n("code",[e._v("Promise")]),e._v(". Elle n'est pas supportée sur Internet Explorer mais il existe des "),n("i",[e._v("polyfills")]),e._v(" pour compléter le support. Comme alternative, vous pouvez passer par d'autres bibliothèques spécialisées telles que\n          "),n("a",{attrs:{href:"https://github.com/axios/axios",target:"_blank"}},[e._v("Axios")]),e._v(", qui est recommandée par l'équipe de Vue.\n        ")]),e._v(" "),n("p",[e._v("On évitera de faire les appels réseau directement depuis le code d'un composant. Cela empêche de réutiliser le code facilement si un autre composant doit faire le même appel réseau. Optez plutôt pour systématiquement séparer la logique applicative de la logique de vos vues.")]),e._v(" "),n("p",[e._v('Une convention est de mettre la logique applicative dans des fichiers JS appelés "services", distribués selon les grands pans fonctionnels de votre application et placés dans un dossier '),n("code",[e._v("services")])]),e._v(" "),n("h2",{staticClass:"subheading primary--text pa-2"},[e._v("\n          Création de services\n        ")]),e._v(" "),n("p",[e._v("- Créer un service générique permettant d'appeler le backend, pour cela, créer un fichier "),n("code",[e._v("services/api.js")]),e._v(" :")]),e._v(" "),n("code-copy",{attrs:{code:e.service_api,copyable:!0,language:"javascript"}}),e._v(" "),n("p",[e._v("Le header "),n("code",[e._v("Authorization")]),e._v(" est utilisé pour envoyer le token d'authentification au backend. Les autres options servent à configurer le cache HTTP et les autorisations cross-origin à appliquer.")]),e._v(" "),n("p",[e._v("- Créer un "),n("code",[e._v("UserService")]),e._v(" qui exploitera les endpoints de l'API concernant la manipulation d'utilisateurs:")]),e._v(" "),n("p",[n("code",[e._v("services/UserService.js")]),e._v(" :")]),e._v(" "),n("code-copy",{attrs:{code:e.service_user,copyable:!0,language:"javascript"}}),e._v(" "),n("h2",{staticClass:"subheading primary--text pa-2"},[e._v("\n          Utilisation des services\n        ")]),e._v(" "),n("p",[e._v("Nous allons modifier le formulaire d'authentification pour appeler UserService et le back-end. Ajoutez un second bouton pour s'inscrire à côté de celui pour se login, puis modifiez les méthodes de LoginForm comme ceci:")]),e._v(" "),n("p",[n("code",[e._v("LoginForm.vue")]),e._v(":")]),e._v(" "),n("code-copy",{attrs:{code:e.service_call,language:"javascript"}}),e._v(" "),n("p",[e._v("Notez que l'on stocke les informations de l'utilisateur dans le store, afin qu'elles soient accessibles depuis n'importe quel composant. Il vous faut donc déclarer les actions et mutations associées dans le store:")]),e._v(" "),n("code-copy",{attrs:{copyable:!0,code:e.store_user,language:"javascript"}}),e._v(" "),n("h1",{staticClass:"headline primary--text pa-4"},[e._v("\n          TP\n        ")]),e._v(" "),n("v-alert",{attrs:{value:!0,color:"info",icon:"info",outline:""}},[n("p",[e._v("Nous allons nous servir d'un back-end existant pour la connexion et la recherche de films.")]),e._v(" "),n("p",[e._v('\n            La partie "backend" de ce TP a été déployée sur Heroku ; le contrat d\'interface du service est disponible sur : '),n("a",{attrs:{href:"https://vue-js-backend.herokuapp.com/api-docs",target:"_blank"}},[e._v("api-docs")])])]),e._v(" "),n("ol",{staticClass:"pt-4"},[n("li",[e._v("Branchez le UserService et les actions de login/inscription en suivant les indications ci-dessus.")]),e._v(" "),n("li",[e._v("La réponse du back-end contient un token permettant d'authentifier l'utilisateur. Ce token devra être envoyé à chaque appel. En cas de succès, ajouter le token dans le store, sinon afficher le message d'erreur. Vérifiez que le token est bien envoyé en header HTTP.")]),e._v(" "),n("li",[e._v("Créer une action vuex pour la déconnexion, en supprimant le token et les infos utilisateur du store, et rediriger vers le formulaire de login.")]),e._v(" "),n("li",[e._v("Créez un service "),n("code",[e._v("FilmService")]),e._v(" avec une méthode pour rechercher les films, en suivant la documentation de l'API ("),n("code",[e._v("GET /movies/search")]),e._v(").")]),e._v(" "),n("li",[e._v("Modifier la page de recherche de films pour appeler le back-end et permettre à l'utilisateur d'entrer le nom d'un film, et d'avoir tout le détail de ce film en sortie.")])])],1),e._v(" "),n("v-card-actions",[n("v-btn",{attrs:{color:"primary",flat:"",nuxt:"",to:"/routing"}},[n("v-icon",{attrs:{left:""}},[e._v("\n            navigate_before\n          ")]),e._v("\n          Routage\n        ")],1),e._v(" "),n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"primary",flat:"",nuxt:"",to:"/reusability"}},[e._v("\n          Réutilisabilité\n          "),n("v-icon",{attrs:{right:""}},[e._v("\n            navigate_next\n          ")])],1)],1)],1)],1)],1)},[],!1,null,null,null);t.default=component.exports;l()(component,{VAlert:d.a,VBtn:h.a,VCard:v.a,VCardActions:m.a,VCardText:m.b,VCardTitle:f.a,VFlex:_.a,VIcon:y.a,VLayout:S.a,VSpacer:k.a})}}]);